<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet | JS Aerospace</title>
<style>
body {
  margin:0;
  font-family:Arial,sans-serif;
  background:#0b0f1a;
  color:white;
}
header {
  background:#11172a;
  padding:20px;
  text-align:center;
}
h1,h2 {margin:0 0 10px;}
.container {max-width:900px;margin:20px auto;display:grid;gap:20px;}
.card {
  background:#1a2140;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 8px rgba(0,0,0,0.3);
}
ul {padding-left:20px;}
li {margin-bottom:8px;}
footer {
  position:relative;
  text-align:center;
  opacity:0.6;
  padding:15px;
}
.version {position:absolute;right:10px;bottom:5px;font-size:0.9em;opacity:0.8;}
a {color:#4da3ff;text-decoration:none;}
a:hover {text-decoration:underline;}
</style>
</head>
<body>

<header>
<h1>GeoNet</h1>
<p>Constelación GNSS – JS Aerospace</p>
</header>

<div class="container">
  <div class="card">
    <h2>Información</h2>
    <p><strong>Planos Orbitales:</strong> <span id="confPlanes">0</span></p>
    <p><strong>Lanzamientos:</strong> <span id="confLaunch">0</span></p>
  </div>

  <div class="card">
    <h2>Lanzamientos</h2>
    <ul id="launchList"></ul>
  </div>

  <div class="card">
    <h2>Galería</h2>
    <ul id="galleryList"></ul>
  </div>
</div>

<footer>
  © JS Aerospace
  <span class="version" id="webVersion">V1</span>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIBwQ4YmJNfyPa9js6cox-sOnZMegKaNA",
  authDomain: "geonet-js-aerospace.firebaseapp.com",
  projectId: "geonet-js-aerospace",
  storageBucket: "geonet-js-aerospace.appspot.com",
  messagingSenderId: "651364423254",
  appId: "1:651364423254:web:f4105d4cd47e95512e8df7",
  measurementId: "G-X44HFVLSQ8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ---------------- VERSION ----------------
const versionElement = document.getElementById("webVersion");
let webVersion = "V1"; // Cambiar manualmente al subir nueva versión
versionElement.textContent = webVersion;

// ---------------- INFORMACIÓN ----------------
const confDoc = doc(db,"Config","Config");
const confPlanes = document.getElementById("confPlanes");
const confLaunch = document.getElementById("confLaunch");

onSnapshot(confDoc, snap=>{
  if(snap.exists()){
    const data = snap.data();
    confPlanes.textContent = data.planos_orbitales||0;
    confLaunch.textContent = data.lanzamientos||0;
  }
});

// ---------------- LANZAMIENTOS ----------------
const launchCol = collection(db,"launches");
const launchList = document.getElementById("launchList");

function formatDateUTCtoLocal(utc){
  if(!utc || utc.toUpperCase()==="NET") return "NET";
  const d = new Date(utc+"Z"); // Forzar UTC
  return d.toLocaleString();
}

onSnapshot(launchCol, snap=>{
  launchList.innerHTML="";
  snap.docs.forEach(d=>{
    const dat = d.data();
    let linksHtml = "";
    if(dat.links && dat.links.length>0){
      linksHtml = "<br>"+dat.links.map(l=>`<a href="${l}" target="_blank">Ver</a>`).join(" ");
    }
    const li = document.createElement("li");
    li.innerHTML = `<strong>${dat.nombre||'Sin nombre'}</strong> | Estado: ${dat.estado||'N/A'} | Fecha: ${formatDateUTCtoLocal(dat.fecha||'NET')} ${linksHtml}`;
    launchList.appendChild(li);
  });
});

// ---------------- GALERÍA ----------------
const galleryCol = collection(db,"Gallery");
const galleryList = document.getElementById("galleryList");

onSnapshot(galleryCol, snap=>{
  galleryList.innerHTML="";
  snap.docs.forEach(d=>{
    const dat = d.data();
    const li = document.createElement("li");
    li.innerHTML = `<a href="${dat.link}" target="_blank">${dat.title||dat.link}</a>`;
    galleryList.appendChild(li);
  });
});
</script>

</body>
</html>