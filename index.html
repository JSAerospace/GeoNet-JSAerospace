<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet | JS Aerospace</title>
<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0b0f1a;
  color:white;
}
header{
  background:#11172a;
  padding:20px;
  text-align:center;
}
section{
  max-width:900px;
  margin:20px auto;
  background:#1a2140;
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 10px rgba(0,0,0,.4);
}
h2{
  border-bottom:1px solid #4da3ff;
  padding-bottom:5px;
}
.card{
  background:#131a33;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}
ul{padding-left:20px;}
li{margin-bottom:15px;}
a{
  color:#4da3ff;
  text-decoration:none;
}
a:hover{color:#6bb5ff;}
.version{
  position:fixed;
  right:10px;
  bottom:8px;
  opacity:.6;
  font-size:14px;
}
.launch-time{
  font-style:italic;
  opacity:.8;
}
</style>
</head>
<body>

<header>
<h1>GeoNet | JS Aerospace</h1>
<p>Seguimiento de lanzamientos y misiones</p>
</header>

<section id="launchesSection">
<h2>Lanzamientos</h2>
<ul id="launchList"></ul>
</section>

<section id="infoSection">
<h2>Información</h2>
<div class="card">
<p><b>Lanzamientos:</b> <span id="infoLaunches"></span></p>
<p><b>Planos Orbitales:</b> <span id="infoPlanes"></span></p>
<p><b>Satélites:</b> <span id="infoSat"></span></p>
</div>
</section>

<section id="gallerySection">
<h2>Galería</h2>
<ul id="galleryList"></ul>
</section>

<div class="version">V1.2</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, getDoc, doc } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAIBwQ4YmJNfyPa9js6cox-sOnZMegKaNA",
  authDomain: "geonet-js-aerospace.firebaseapp.com",
  projectId: "geonet-js-aerospace",
  storageBucket: "geonet-js-aerospace.appspot.com",
  messagingSenderId: "651364423254",
  appId: "1:651364423254:web:f4105d4cd47e95512e8df7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Información
const infoDoc = doc(db,"Config","info");
const loadInfo = async()=>{
  const d = await getDoc(infoDoc);
  if(d.exists()){
    infoLaunches.textContent=d.data().lanzamientos;
    infoPlanes.textContent=d.data().planos_orbitales;
    infoSat.textContent=d.data().satelites;
  }
};
loadInfo();

// Galería
const galleryCol = collection(db,"Gallery");
onSnapshot(galleryCol,snap=>{
  galleryList.innerHTML="";
  snap.forEach(d=>{
    const data=d.data();
    const li=document.createElement("li");
    let url = data.url;
    if(url.match(/\.(jpg|jpeg|png|gif)$/i)){
      li.innerHTML=`<img src="${url}" style="max-width:100%; border-radius:10px;">`;
    } else {
      li.innerHTML=`<a href="${url}" target="_blank">${url}</a>`;
    }
    galleryList.appendChild(li);
  });
});

// Lanzamientos
const launches = collection(db,"launches");

const formatLaunchDate = (fechaObj) => {
  if(fechaObj.tipo==="EXACTA"){
    const d = new Date(fechaObj.valor);
    return d.toLocaleString();
  } else if(fechaObj.tipo==="NET"){
    const vals = fechaObj.valor.split("-");
    let str="NET ";
    if(fechaObj.precision==="year") str+=vals[0];
    if(fechaObj.precision==="month") str+=` ${vals[1]||""}/${vals[0]||""}`;
    if(fechaObj.precision==="day") str+=` ${vals[2]||""}/${vals[1]||""}/${vals[0]||""}`;
    return str;
  }
  return "";
};

onSnapshot(launches,snap=>{
  launchList.innerHTML="";
  snap.forEach(d=>{
    const data=d.data();
    const li=document.createElement("li");
    li.classList.add("card");
    li.innerHTML=`
      <b>${data.nombre}</b> (${data.estado})<br>
      <span class="launch-time">${formatLaunchDate(data.fecha)}</span><br>
      ${data.links.map(l=>l.match(/\.(jpg|jpeg|png|gif)$/i)? 
        `<img src="${l}" style="max-width:100%; border-radius:10px;">` : 
        `<a href="${l}" target="_blank">${l}</a>`).join("<br>")}
    `;
    launchList.appendChild(li);
  });
});
</script>

</body>
</html>