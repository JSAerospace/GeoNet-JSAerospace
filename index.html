<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet V4.5</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
h2{margin-top:25px;margin-bottom:10px}
.img-gallery img, .img-gallery video{max-width:100%;margin-top:10px;border-radius:8px}
.flex{display:flex;gap:10px;flex-wrap:wrap}
</style>
</head>
<body>

<section>
<h2>Información</h2>
<div class="card">
<strong>Lanzamientos:</strong> <span id="infoLanzamientos">-</span><br>
<strong>Planos Orbitales:</strong> <span id="infoPlanos">-</span><br>
<strong>N° de Satélites:</strong> <span id="infoSat">-</span>
</div>
</section>

<section>
<h2>Lanzamientos</h2>
<div id="launchList"></div>
</section>

<section>
<h2>Galería</h2>
<div id="gallery" class="img-gallery"></div>
</section>

<div class="version">v4.5</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,getDoc,getDocs,collection} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"TU_API_KEY",
  authDomain:"geonet-js-aerospace.firebaseapp.com",
  projectId:"geonet-js-aerospace"
});
const db = getFirestore(app);

// Cargar Información
async function loadInfo(){
  const docSnap = await getDoc(doc(db,"Config","info"));
  if(docSnap.exists()){
    const data = docSnap.data();
    document.getElementById("infoLanzamientos").textContent = data.lanzamientos || "-";
    document.getElementById("infoPlanos").textContent = data.planos_orbitales || "-";
    document.getElementById("infoSat").textContent = data.satelites || "-";
  }
}
loadInfo();

// Función para mostrar enlaces embebibles o links
function renderMedia(url){
  if(url.includes("imgur.com") || url.match(/\.(jpg|jpeg|png|gif|mp4)$/i)){
    if(url.match(/\.(mp4|webm|ogg)$/i)) return `<video controls src="${url}"></video>`;
    else return `<img src="${url}">`;
  } else {
    return `<a href="${url}" target="_blank" style="color:#0af;">${url}</a>`;
  }
}

// Cargar lanzamientos
async function loadLaunches(){
  const listDiv = document.getElementById("launchList");
  listDiv.innerHTML = "";
  const snaps = await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data = d.data();
    const card = document.createElement("div");
    card.className = "card";
    
    let fechaDisplay = "-";
    if(data.tipo==="FECHA" && data.fecha){
      const dt = new Date(data.fecha);
      fechaDisplay = dt.toLocaleString();
    } else if(data.tipo==="NET" && data.net){
      fechaDisplay = data.net;
    }

    let galeriaHTML = "-";
    if(data.galeria?.length){
      galeriaHTML = data.galeria.map(url=>renderMedia(url)).join("");
    }

    card.innerHTML=`
      <strong>Nombre:</strong> ${data.nombre}<br>
      <strong>Vehículo:</strong> ${data.vehiculo || "-"}<br>
      <strong>Estado:</strong> ${data.estado || "-"}<br>
      <strong>Fecha/NET:</strong> ${fechaDisplay}<br>
      <strong>Carga:</strong> ${data.carga || "-"}<br>
      <strong>Galería:</strong><br>${galeriaHTML}
    `;
    listDiv.appendChild(card);
  });
}
loadLaunches();

// Cargar galería independiente
async function loadGallery(){
  const galleryDiv = document.getElementById("gallery");
  galleryDiv.innerHTML="";
  const snaps = await getDocs(collection(db,"gallery"));
  snaps.forEach(d=>{
    galleryDiv.innerHTML += renderMedia(d.data().url);
  });
}
loadGallery();

</script>
</body>
</html>