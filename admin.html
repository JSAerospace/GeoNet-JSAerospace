<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#1e90ff;color:#fff;font-weight:bold}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px}
.hidden{display:none}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
</style>
</head>
<body>

<section id="login">
<h2>Admin Login</h2>
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</section>

<section id="panel" class="hidden">

<h2>Información</h2>
<input id="infoNombre" placeholder="Nombre">
<input id="infoValor" placeholder="Valor">
<button onclick="saveInfo()">Guardar</button>

<h2>Lanzamiento</h2>
<input id="lNombre" placeholder="Nombre misión">
<select id="lEstado">
<option>PLANNED</option>
<option>NET</option>
<option>LAUNCHED</option>
<option>CANCELLED</option>
</select>
<select id="lTipo">
<option value="FECHA">Fecha exacta</option>
<option value="NET">NET</option>
</select>
<input id="lFecha" type="datetime-local">
<input id="lNet" placeholder="NET Diciembre 2026">
<input id="lCarga" placeholder="Carga">
<button onclick="saveLaunch()">Guardar / Actualizar</button>

<h2>Galería</h2>
<input id="gUrl" placeholder="URL imagen o video">
<button onclick="addGallery()">Agregar</button>

<div id="launchList"></div>

</section>

<div class="version">v1.5</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,setDoc,collection,addDoc,getDocs,updateDoc,deleteDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey: "TU_API_KEY",
  authDomain: "geonet-js-aerospace.firebaseapp.com",
  projectId: "geonet-js-aerospace"
});
const db = getFirestore(app);

window.login=()=>{
 if(user.value==="olanoagus@gmail.com" && pass.value==="Simba2011"){
  login.classList.add("hidden");
  panel.classList.remove("hidden");
  loadLaunches();
 }
}

// Información
window.saveInfo=()=>{
 setDoc(doc(db,"Config","info"),{
  [infoNombre.value]:infoValor.value
 },{merge:true});
}

// Lanzamientos
window.saveLaunch=async()=>{
 if(lNombre.value==="") return alert("Debe poner un nombre");
 if(lTipo.value==="NET"){
   await addDoc(collection(db,"launches"),{
     nombre:lNombre.value,
     estado:lEstado.value,
     tipo:"NET",
     net:lNet.value,
     carga:lCarga.value
   });
 } else {
   await addDoc(collection(db,"launches"),{
     nombre:lNombre.value,
     estado:lEstado.value,
     tipo:"FECHA",
     fecha:lFecha.value,
     carga:lCarga.value
   });
 }
 loadLaunches();
}

// Galería
window.addGallery=()=>{
 addDoc(collection(db,"Gallery"),{url:gUrl.value});
}

// Listar lanzamientos para editar/borrar
async function loadLaunches(){
 const listDiv=document.getElementById("launchList");
 listDiv.innerHTML="";
 const snaps = await getDocs(collection(db,"launches"));
 snaps.forEach(d=>{
   const data=d.data();
   const id=d.id;
   listDiv.innerHTML+=`
   <div class="card">
     <strong>${data.nombre}</strong> - ${data.estado} - ${data.tipo==="NET"?data.net:new Date(data.fecha).toLocaleString()}
     <button onclick="editLaunch('${id}')">Editar</button>
     <button onclick="deleteLaunch('${id}')">Borrar</button>
   </div>`;
 });
}

// Editar
window.editLaunch=async(id)=>{
 const docRef=doc(db,"launches",id);
 const docSnap=await getDocs(collection(db,"launches"));
 docSnap.forEach(d=>{
   if(d.id===id){
     const data=d.data();
     lNombre.value=data.nombre;
     lEstado.value=data.estado;
     lTipo.value=data.tipo;
     lFecha.value=data.fecha || "";
     lNet.value=data.net || "";
     lCarga.value=data.carga;
   }
 });
 await deleteDoc(docRef); // borramos el original, se guardará al presionar guardar
}

// Borrar
window.deleteLaunch=async(id)=>{
 if(!confirm("¿Seguro que quieres borrar este lanzamiento?")) return;
 await deleteDoc(doc(db,"launches",id));
 loadLaunches();
}
</script>
</body>
</html>