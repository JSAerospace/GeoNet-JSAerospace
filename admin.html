<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet Admin V3.7</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#1e90ff;color:#fff;font-weight:bold;cursor:pointer}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
.hidden{display:none}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
.card button{width:48%;margin:2px 1%;font-weight:bold}
.card button.delete{background:#dc3545;color:#fff}
.card button:not(.delete){background:#28a745;color:#fff}
.flex{display:flex;gap:5px;flex-wrap:wrap}
</style>
</head>
<body>

<section id="login">
<h2>Admin Login</h2>
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</section>

<section id="panel" class="hidden">

<button onclick="logout()" style="margin-bottom:15px;background:#dc3545;">Cerrar sesión</button>

<h2>Información</h2>
<div class="card">
  <label>Lanzamientos:</label>
  <input id="infoLanzamientos" type="number" placeholder="Cantidad de lanzamientos">
</div>
<div class="card">
  <label>Planos Orbitales:</label>
  <input id="infoPlanos" type="number" placeholder="Cantidad de planos orbitales">
</div>
<div class="card">
  <label>N° de Satélites:</label>
  <input id="infoSat" type="number" placeholder="Cantidad de satélites">
</div>
<button onclick="saveAllInfo()">Cambiar Información</button>

<h2>Lanzamiento</h2>
<input id="lNombre" placeholder="Nombre misión">

<select id="lEstado">
<option>Éxito</option>
<option>Fallidos</option>
<option>Planeado</option>
<option>En Vuelo</option>
</select>

<select id="lTipo">
<option value="FECHA">Fecha Exacta</option>
<option value="NET">NET</option>
</select>

<div id="fechaDiv">
<input id="lFecha" type="datetime-local">
</div>

<div id="netDiv" class="hidden">
<label>Precisión NET:</label>
<select id="netLevel">
<option value="year">Solo Año</option>
<option value="month">Mes y Año</option>
<option value="day">Día, Mes y Año</option>
</select>

<div id="netYearDiv">
<select id="netYear"></select>
</div>
<div id="netMonthDiv" class="hidden">
<select id="netMonth">
<option value="">Mes</option>
<option value="Enero">Enero</option><option value="Febrero">Febrero</option>
<option value="Marzo">Marzo</option><option value="Abril">Abril</option>
<option value="Mayo">Mayo</option><option value="Junio">Junio</option>
<option value="Julio">Julio</option><option value="Agosto">Agosto</option>
<option value="Septiembre">Septiembre</option><option value="Octubre">Octubre</option>
<option value="Noviembre">Noviembre</option><option value="Diciembre">Diciembre</option>
</select>
</div>
<div id="netDayDiv" class="hidden">
<select id="netDay">
<option value="">Día</option>
</select>
</div>

<input id="lCarga" placeholder="Carga">
<button onclick="saveLaunch()">Guardar / Actualizar</button>

<h2>Galería</h2>
<input id="gUrl" placeholder="URL imagen o video">
<button onclick="addGallery()">Agregar</button>

<h2>Lanzamientos Existentes</h2>
<div id="launchList"></div>

</section>

<div class="version">v3.7</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,setDoc,collection,addDoc,getDocs,deleteDoc,getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({apiKey:"TU_API_KEY",authDomain:"geonet-js-aerospace.firebaseapp.com",projectId:"geonet-js-aerospace"});
const db = getFirestore(app);

// LOGIN
const loginForm = document.getElementById("login");
const panel = document.getElementById("panel");
const user = document.getElementById("user");
const pass = document.getElementById("pass");

window.addEventListener("load",()=>{
  if(localStorage.getItem("loggedIn")==="true"){
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo();
    loadLaunches();
  }
});

window.login = () => {
  if(user.value==="olanoagus@gmail.com" && pass.value==="Simba2011"){
    localStorage.setItem("loggedIn","true");
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo();
    loadLaunches();
  } else alert("Usuario o contraseña incorrecta");
};

window.logout = () => {
  localStorage.removeItem("loggedIn");
  panel.classList.add("hidden");
  loginForm.classList.remove("hidden");
};

// Información
async function loadInfo(){
  const docRef=doc(db,"Config","info");
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()){
    const data=docSnap.data();
    infoLanzamientos.value = data.lanzamientos || "";
    infoPlanos.value = data.planos_orbitales || "";
    infoSat.value = data.satelites || "";
  }
}
window.saveAllInfo=async()=>{
  await setDoc(doc(db,"Config","info"),{
    lanzamientos: parseInt(infoLanzamientos.value)||0,
    planos_orbitales: parseInt(infoPlanos.value)||0,
    satelites: parseInt(infoSat.value)||0
  },{merge:true});
  alert("Información actualizada!");
};

// Lanzamientos
const lTipo = document.getElementById("lTipo");
const lFecha = document.getElementById("lFecha");
const netDiv = document.getElementById("netDiv");
const fechaDiv = document.getElementById("fechaDiv");
const netLevel = document.getElementById("netLevel");
const netYear = document.getElementById("netYear");
const netMonth = document.getElementById("netMonth");
const netDay = document.getElementById("netDay");
const netMonthDiv = document.getElementById("netMonthDiv");
const netDayDiv = document.getElementById("netDayDiv");

for(let y=new Date().getFullYear();y<=new Date().getFullYear()+10;y++){
  netYear.innerHTML += `<option value="${y}">${y}</option>`;
}
for(let d=1;d<=31;d++) netDay.innerHTML += `<option value="${d}">${d}</option>`;

function toggleTipoFecha(){
  if(lTipo.value==="FECHA"){
    fechaDiv.classList.remove("hidden");
    netDiv.classList.add("hidden");
  } else {
    fechaDiv.classList.add("hidden");
    netDiv.classList.remove("hidden");
    toggleNetLevel();
  }
}

function toggleNetLevel(){
  const level = netLevel.value;
  netMonthDiv.classList.toggle("hidden",level==="year");
  netDayDiv.classList.toggle("hidden",level!=="day");
}

lTipo.addEventListener("change",toggleTipoFecha);
netLevel.addEventListener("change",toggleNetLevel);

// Guardar lanzamiento
window.saveLaunch = async () => {
  const lNombreVal = document.getElementById("lNombre").value;
  const lEstadoVal = document.getElementById("lEstado").value;
  const lCargaVal = document.getElementById("lCarga").value;
  if(!lNombreVal) return alert("Debe poner un nombre de misión");
  let data;
  if(lTipo.value==="FECHA"){
    data={nombre:lNombreVal,estado:lEstadoVal,tipo:"FECHA",fecha:lFecha.value,carga:lCargaVal};
  } else {
    let netText="NET";
    const level=netLevel.value;
    if(level==="year") netText+=` ${netYear.value}`;
    if(level==="month") netText=`NET ${netMonth.value} ${netYear.value}`;
    if(level==="day") netText=`NET ${netDay.value} ${netMonth.value} ${netYear.value}`;
    data={nombre:lNombreVal,estado:lEstadoVal,tipo:"NET",net:netText,carga:lCargaVal};
  }
  await addDoc(collection(db,"launches"),data);
  document.getElementById("lNombre").value="";
  document.getElementById("lEstado").value="Planeado";
  lTipo.value="FECHA"; toggleTipoFecha();
  lFecha.value=""; netYear.value=""; netMonth.value=""; netDay.value=""; document.getElementById("lCarga").value="";
  loadLaunches();
};

// Galería
window.addGallery = async () => { 
  const url=document.getElementById("gUrl").value;
  if(!url) return; 
  await addDoc(collection(db,"Gallery"),{url}); 
  document.getElementById("gUrl").value="";
};

// Listar lanzamientos mejorado
async function loadLaunches(){
  const listDiv=document.getElementById("launchList");
  listDiv.innerHTML="";
  const snaps=await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data=d.data(); const id=d.id;
    const dateDisplay=data.tipo==="NET"?data.net:new Date(data.fecha).toLocaleString();

    const card=document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <div style="display:flex;flex-direction:column;gap:5px">
        <strong>Nombre:</strong> ${data.nombre}
        <strong>Estado:</strong> ${data.estado}
        <strong>Fecha/NET:</strong> ${dateDisplay}
        <strong>Carga:</strong> ${data.carga}
      </div>
      <div class="flex" style="margin-top:10px;">
        <button onclick="editLaunch('${id}')">Editar</button>
        <button class="delete" onclick="deleteLaunch('${id}')">Borrar</button>
      </div>
    `;
    listDiv.appendChild(card);
  });
}

// Editar lanzamiento
window.editLaunch=async(id)=>{
  const snaps=await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    if(d.id===id){
      const data=d.data();
      document.getElementById("lNombre").value=data.nombre;
      document.getElementById("lEstado").value=data.estado;
      lTipo.value=data.tipo;
      toggleTipoFecha();
      if(data.tipo==="FECHA") lFecha.value=data.fecha;
      else {
        const parts=data.net.split(" ");
        if(parts.length===2){netLevel.value="year"; netYear.value=parts[1]; toggleNetLevel();}
        if(parts.length===3){netLevel.value="month"; netMonth.value=parts[1]; netYear.value=parts[2]; toggleNetLevel();}
        if(parts.length===4){netLevel.value="day"; netDay.value=parts[1]; netMonth.value=parts[2]; netYear.value=parts[3]; toggleNetLevel();}
      }
      document.getElementById("lCarga").value=data.carga;
    }
  });
  await deleteDoc(doc(db,"launches",id));
};

// Borrar lanzamiento
window.deleteLaunch=async(id)=>{
  if(!confirm("¿Seguro que quieres borrar este lanzamiento?")) return;
  await deleteDoc(doc(db,"launches",id));
  loadLaunches();
};

loadInfo();
loadLaunches();
toggleTipoFecha();
</script>

</body>
</html>