<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin GeoNet V4.5</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
input, select, button{padding:5px;margin-top:5px;margin-bottom:10px;width:100%;border-radius:5px;border:none}
button{background:#0af;color:#000;font-weight:bold;cursor:pointer}
h2{margin-top:25px;margin-bottom:10px}
.flex{display:flex;gap:10px;flex-wrap:wrap}
.img-gallery img, .img-gallery video{max-width:100%;margin-top:10px;border-radius:8px}
.card-launch{margin-bottom:10px;padding:10px;background:#1a2030;border-radius:10px;box-shadow:0 0 5px rgba(0,0,0,0.5)}
.card-launch button{width:auto;margin-top:5px;padding:3px 10px;background:#0af;color:#000}
</style>
</head>
<body>

<section>
<h2>Información</h2>
<div class="card">
<label>Lanzamientos:</label>
<input type="number" id="inputLanzamientos">
<label>Planos Orbitales:</label>
<input type="number" id="inputPlanos">
<label>N° de Satélites:</label>
<input type="number" id="inputSat">
<button id="btnCambiarInfo">Cambiar Información</button>
</div>
</section>

<section>
<h2>Agregar/Editar Lanzamiento</h2>
<div class="card">
<label>Nombre:</label><input type="text" id="inputNombre">
<label>Vehículo:</label><input type="text" id="inputVehiculo">
<label>Estado:</label>
<select id="inputEstado">
  <option value="Éxito">Éxito</option>
  <option value="Fallido">Fallido</option>
  <option value="Planeado">Planeado</option>
  <option value="En Vuelo">En Vuelo</option>
</select>
<label>Tipo de Fecha:</label>
<select id="inputTipoFecha">
  <option value="FECHA">Fecha Exacta</option>
  <option value="NET">NET</option>
</select>
<label id="labelFecha">Fecha:</label>
<input type="datetime-local" id="inputFecha">
<div id="netInputs" style="display:none">
  <label>NET:</label>
  <input type="text" id="inputNet" placeholder="Ej: NET Diciembre 2026">
</div>
<label>Carga:</label><input type="text" id="inputCarga">
<label>Galería (separar por comas):</label><input type="text" id="inputGaleria">
<button id="btnAgregarLanzamiento">Agregar/Editar Lanzamiento</button>
</div>
</section>

<section>
<h2>Lanzamientos Existentes</h2>
<div id="launchesAdmin"></div>
</section>

<section>
<h2>Galería</h2>
<div class="card">
<label>URL Imagen/Video/Enlace:</label>
<input type="text" id="inputGaleriaURL">
<button id="btnAgregarGaleria">Agregar a Galería</button>
</div>
<div id="galeriaAdmin" class="img-gallery"></div>
</section>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,getDoc,getDocs,setDoc,collection,addDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"TU_API_KEY",
  authDomain:"geonet-js-aerospace.firebaseapp.com",
  projectId:"geonet-js-aerospace"
});
const db = getFirestore(app);

let editingId = null;

// Mostrar/ocultar inputs NET
const tipoFecha = document.getElementById("inputTipoFecha");
tipoFecha.addEventListener("change",()=>{
  if(tipoFecha.value==="NET"){
    document.getElementById("inputFecha").style.display="none";
    document.getElementById("netInputs").style.display="block";
  } else {
    document.getElementById("inputFecha").style.display="block";
    document.getElementById("netInputs").style.display="none";
  }
});

// Cambiar Información
document.getElementById("btnCambiarInfo").addEventListener("click",async()=>{
  await setDoc(doc(db,"Config","info"),{
    lanzamientos: Number(document.getElementById("inputLanzamientos").value),
    planos_orbitales: Number(document.getElementById("inputPlanos").value),
    satelites: Number(document.getElementById("inputSat").value)
  });
  alert("Información actualizada");
});

// Función para mostrar enlaces embebibles o links
function renderMedia(url){
  if(url.includes("imgur.com") || url.match(/\.(jpg|jpeg|png|gif|mp4)$/i)){
    if(url.match(/\.(mp4|webm|ogg)$/i)) return `<video controls src="${url}"></video>`;
    else return `<img src="${url}">`;
  } else {
    return `<a href="${url}" target="_blank" style="color:#0af;">${url}</a>`;
  }
}

// Cargar Información inicial
async function loadInfo(){
  const docSnap = await getDoc(doc(db,"Config","info"));
  if(docSnap.exists()){
    const data = docSnap.data();
    document.getElementById("inputLanzamientos").value = data.lanzamientos || "";
    document.getElementById("inputPlanos").value = data.planos_orbitales || "";
    document.getElementById("inputSat").value = data.satelites || "";
  }
}
loadInfo();

// Agregar/Editar Lanzamiento
document.getElementById("btnAgregarLanzamiento").addEventListener("click",async()=>{
  const nombre = document.getElementById("inputNombre").value;
  const vehiculo = document.getElementById("inputVehiculo").value;
  const estado = document.getElementById("inputEstado").value;
  const tipo = document.getElementById("inputTipoFecha").value;
  const fecha = tipo==="FECHA"?document.getElementById("inputFecha").value:null;
  const net = tipo==="NET"?document.getElementById("inputNet").value:null;
  const carga = document.getElementById("inputCarga").value;
  const galeria = document.getElementById("inputGaleria").value.split(",").map(x=>x.trim()).filter(x=>x);

  if(editingId){
    await setDoc(doc(db,"launches",editingId),{nombre,vehiculo,estado,tipo,fecha,net,carga,galeria});
    editingId=null;
    alert("Lanzamiento editado");
  } else {
    await addDoc(collection(db,"launches"),{nombre,vehiculo,estado,tipo,fecha,net,carga,galeria});
    alert("Lanzamiento agregado");
  }
  document.getElementById("inputNombre").value="";
  document.getElementById("inputVehiculo").value="";
  document.getElementById("inputCarga").value="";
  document.getElementById("inputGaleria").value="";
  document.getElementById("inputFecha").value="";
  document.getElementById("inputNet").value="";
  loadLaunchesAdmin();
});

// Cargar lanzamientos existentes en admin
async function loadLaunchesAdmin(){
  const container = document.getElementById("launchesAdmin");
  container.innerHTML="";
  const snaps = await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data = d.data();
    const card = document.createElement("div");
    card.className="card-launch";
    let fechaDisplay="-";
    if(data.tipo==="FECHA" && data.fecha) fechaDisplay = new Date(data.fecha).toLocaleString();
    if(data.tipo==="NET" && data.net) fechaDisplay = data.net;

    let galeriaHTML="-";
    if(data.galeria?.length) galeriaHTML = data.galeria.map(url=>renderMedia(url)).join("");

    card.innerHTML=`
      <strong>Nombre:</strong> ${data.nombre}<br>
      <strong>Vehículo:</strong> ${data.vehiculo || "-"}<br>
      <strong>Estado:</strong> ${data.estado || "-"}<br>
      <strong>Fecha/NET:</strong> ${fechaDisplay}<br>
      <strong>Carga:</strong> ${data.carga || "-"}<br>
      <strong>Galería:</strong><br>${galeriaHTML}
      <button data-id="${d.id}">Editar</button>
    `;
    card.querySelector("button").addEventListener("click",()=>{
      document.getElementById("inputNombre").value = data.nombre;
      document.getElementById("inputVehiculo").value = data.vehiculo || "";
      document.getElementById("inputEstado").value = data.estado || "Planeado";
      document.getElementById("inputTipoFecha").value = data.tipo || "FECHA";
      if(data.tipo==="FECHA"){
        document.getElementById("inputFecha").style.display="block";
        document.getElementById("netInputs").style.display="none";
        document.getElementById("inputFecha").value = data.fecha || "";
      } else {
        document.getElementById("inputFecha").style.display="none";
        document.getElementById("netInputs").style.display="block";
        document.getElementById("inputNet").value = data.net || "";
      }
      document.getElementById("inputCarga").value = data.carga || "";
      document.getElementById("inputGaleria").value = data.galeria?.join(",") || "";
      editingId = d.id;
    });

    container.appendChild(card);
  });
}
loadLaunchesAdmin();

// Agregar a galería
document.getElementById("btnAgregarGaleria").addEventListener("click",async()=>{
  const url = document.getElementById("inputGaleriaURL").value.trim();
  if(url){
    await addDoc(collection(db,"gallery"),{url});
    document.getElementById("inputGaleriaURL").value="";
    loadGaleriaAdmin();
  }
});

// Cargar galería admin
async function loadGaleriaAdmin(){
  const div = document.getElementById("galeriaAdmin");
  div.innerHTML="";
  const snaps = await getDocs(collection(db,"gallery"));
  snaps.forEach(d=>{
    div.innerHTML += renderMedia(d.data().url);
  });
}
loadGaleriaAdmin();

</script>
</body>
</html>