<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet Admin V3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#1e90ff;color:#fff;font-weight:bold;cursor:pointer}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
.hidden{display:none}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
.card button{width:48%;margin:2px 1%;background:#28a745;color:#fff;font-weight:bold}
.card button.delete{background:#dc3545}
</style>
</head>
<body>

<section id="login">
<h2>Admin Login</h2>
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</section>

<section id="panel" class="hidden">

<!-- SECCIÓN DE INFORMACIÓN -->
<h2>Información</h2>
<div class="card">
  <label>Lanzamientos:</label>
  <input id="infoLanzamientos" type="number" placeholder="Cantidad de lanzamientos">
</div>
<div class="card">
  <label>Planos Orbitales:</label>
  <input id="infoPlanos" type="number" placeholder="Cantidad de planos orbitales">
</div>
<div class="card">
  <label>N° de Satélites:</label>
  <input id="infoSat" type="number" placeholder="Cantidad de satélites">
</div>
<button onclick="saveAllInfo()">Cambiar Información</button>

<!-- SECCIÓN DE LANZAMIENTOS -->
<h2>Lanzamiento</h2>
<input id="lNombre" placeholder="Nombre misión">
<select id="lEstado">
<option>PLANNED</option>
<option>NET</option>
<option>LAUNCHED</option>
<option>CANCELLED</option>
</select>
<select id="lTipo">
<option value="FECHA">Fecha exacta</option>
<option value="NET">NET</option>
</select>
<input id="lFecha" type="datetime-local">
<input id="lNet" placeholder="NET Diciembre 2026">
<input id="lCarga" placeholder="Carga">
<button onclick="saveLaunch()">Guardar / Actualizar</button>

<h2>Galería</h2>
<input id="gUrl" placeholder="URL imagen o video">
<button onclick="addGallery()">Agregar</button>

<h2>Lanzamientos Existentes</h2>
<div id="launchList"></div>

</section>

<div class="version">v3.0</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,setDoc,collection,addDoc,getDocs,deleteDoc,getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({apiKey:"TU_API_KEY",authDomain:"geonet-js-aerospace.firebaseapp.com",projectId:"geonet-js-aerospace"});
const db = getFirestore(app);

// LOGIN
const loginForm = document.getElementById("login");
const panel = document.getElementById("panel");
const user = document.getElementById("user");
const pass = document.getElementById("pass");

window.login = () => {
  if(user.value==="olanoagus@gmail.com" && pass.value==="Simba2011"){
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo();
    loadLaunches();
  } else alert("Usuario o contraseña incorrecta");
};

// ---------------- SECCIÓN INFORMACIÓN ----------------
async function loadInfo(){
  const docRef=doc(db,"Config","info");
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()){
    const data=docSnap.data();
    infoLanzamientos.value = data.lanzamientos || "";
    infoPlanos.value = data.planos_orbitales || "";
    infoSat.value = data.satelites || "";
  }
}

window.saveAllInfo=async()=>{
  await setDoc(doc(db,"Config","info"),{
    lanzamientos: parseInt(infoLanzamientos.value)||0,
    planos_orbitales: parseInt(infoPlanos.value)||0,
    satelites: parseInt(infoSat.value)||0
  },{merge:true});
  alert("Información actualizada!");
};

// ---------------- SECCIÓN LANZAMIENTOS ----------------
window.saveLaunch = async () => {
  if(!lNombre.value) return alert("Debe poner un nombre de misión");
  let data = (lTipo.value==="NET") ? 
    {nombre:lNombre.value,estado:lEstado.value,tipo:"NET",net:lNet.value,carga:lCarga.value} :
    {nombre:lNombre.value,estado:lEstado.value,tipo:"FECHA",fecha:lFecha.value,carga:lCarga.value};
  await addDoc(collection(db,"launches"),data);
  lNombre.value=""; lEstado.value="PLANNED"; lTipo.value="FECHA"; lFecha.value=""; lNet.value=""; lCarga.value="";
  loadLaunches();
};

// ---------------- GALERÍA ----------------
window.addGallery = async () => { 
  if(!gUrl.value) return; 
  await addDoc(collection(db,"Gallery"),{url:gUrl.value}); 
  gUrl.value=""; 
};

// ---------------- LISTAR LANZAMIENTOS ----------------
async function loadLaunches(){
  const listDiv = document.getElementById("launchList");
  listDiv.innerHTML="";
  const snaps = await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data=d.data(); const id=d.id;
    let dateDisplay = data.tipo==="NET"?data.net:new Date(data.fecha).toLocaleString();
    listDiv.innerHTML += `<div class="card"><strong>${data.nombre}</strong> - ${data.estado} - ${dateDisplay}<button onclick="editLaunch('${id}')">Editar</button><button class="delete" onclick="deleteLaunch('${id}')">Borrar</button></div>`;
  });
}

// Editar lanzamiento
window.editLaunch = async (id) => {
  const docRef = doc(db,"launches",id);
  const docSnap = await getDocs(collection(db,"launches"));
  docSnap.forEach(d=>{
    if(d.id===id){
      const data=d.data();
      lNombre.value=data.nombre; lEstado.value=data.estado; lTipo.value=data.tipo; lFecha.value=data.fecha||""; lNet.value=data.net||""; lCarga.value=data.carga;
    }
  });
  await deleteDoc(docRef);
};

// Borrar lanzamiento
window.deleteLaunch = async (id) => {
  if(!confirm("¿Seguro que quieres borrar este lanzamiento?")) return;
  await deleteDoc(doc(db,"launches",id));
  loadLaunches();
};

loadInfo();
loadLaunches();
</script>

</body>
</html>