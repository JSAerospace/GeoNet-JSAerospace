<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet Admin V4.3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none;font-size:14px}
button{background:#1e90ff;color:#fff;font-weight:bold;cursor:pointer}
button.delete{background:#dc3545;color:#fff}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
.hidden{display:none}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
.flex{display:flex;gap:5px;flex-wrap:wrap}
h2{margin-top:25px;margin-bottom:10px}
</style>
</head>
<body>

<section id="login">
<h2>Admin Login</h2>
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</section>

<section id="panel" class="hidden">

<button onclick="logout()" style="margin-bottom:15px;background:#dc3545;">Cerrar sesión</button>

<h2>Información</h2>
<div class="card">
  <label>Lanzamientos:</label>
  <input id="infoLanzamientos" type="number" placeholder="Cantidad de lanzamientos">
</div>
<div class="card">
  <label>Planos Orbitales:</label>
  <input id="infoPlanos" type="number" placeholder="Cantidad de planos orbitales">
</div>
<div class="card">
  <label>N° de Satélites:</label>
  <input id="infoSat" type="number" placeholder="Cantidad de satélites">
</div>
<button onclick="saveAllInfo()">Cambiar Información</button>

<h2>Crear / Editar Lanzamiento</h2>
<div class="card">
<input id="lNombre" placeholder="Nombre misión">
<select id="lEstado">
<option>Éxito</option>
<option>Fallidos</option>
<option>Planeado</option>
<option>En Vuelo</option>
</select>

<select id="lTipo">
<option value="FECHA">Fecha Exacta</option>
<option value="NET">NET</option>
</select>

<div id="fechaDiv">
  <input id="lFecha" type="datetime-local">
</div>

<div id="netDiv" class="hidden">
<label>Precisión NET:</label>
<select id="netLevel">
<option value="year">Solo Año</option>
<option value="month">Mes y Año</option>
<option value="day">Día, Mes y Año</option>
</select>

<div id="netYearDiv">
<select id="netYear"></select>
</div>
<div id="netMonthDiv" class="hidden">
<select id="netMonth">
<option>Enero</option><option>Febrero</option><option>Marzo</option><option>Abril</option>
<option>Mayo</option><option>Junio</option><option>Julio</option><option>Agosto</option>
<option>Septiembre</option><option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
</select>
</div>
<div id="netDayDiv" class="hidden">
<select id="netDay">
<option>1</option><option>2</option><option>3</option><option>4</option>
<option>5</option><option>6</option><option>7</option><option>8</option>
<option>9</option><option>10</option><option>11</option><option>12</option>
<option>13</option><option>14</option><option>15</option><option>16</option>
<option>17</option><option>18</option><option>19</option><option>20</option>
<option>21</option><option>22</option><option>23</option><option>24</option>
<option>25</option><option>26</option><option>27</option><option>28</option>
<option>29</option><option>30</option><option>31</option>
</select>
</div>
</div>

<input id="lCarga" placeholder="Carga">
<input id="gUrl" placeholder="URL imagen/video">

<div style="margin-top:10px;">
<button onclick="saveLaunch()">Guardar / Actualizar Lanzamiento</button>
</div>
</div>

<h2>Lanzamientos Existentes</h2>
<div id="launchList"></div>

<h2>Galería</h2>
<div id="galeria" class="card">
<input id="imgUrl" placeholder="URL de imagen/video">
<button onclick="addGallery()">Agregar a Galería</button>
<div id="galleryList" style="margin-top:10px;"></div>
</div>

</section>

<div class="version">v4.3</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,setDoc,collection,addDoc,getDocs,deleteDoc,getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"TU_API_KEY",
  authDomain:"geonet-js-aerospace.firebaseapp.com",
  projectId:"geonet-js-aerospace"
});
const db = getFirestore(app);

// Login
const loginForm = document.getElementById("login");
const panel = document.getElementById("panel");
const user = document.getElementById("user");
const pass = document.getElementById("pass");
window.addEventListener("load",()=>{
  if(localStorage.getItem("loggedIn")==="true"){
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo(); loadLaunches(); loadGallery();
  }
});
window.login = () => {
  if(user.value==="olanoagus@gmail.com" && pass.value==="Simba2011"){
    localStorage.setItem("loggedIn","true");
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo(); loadLaunches(); loadGallery();
  } else alert("Usuario o contraseña incorrecta");
};
window.logout = () => { localStorage.removeItem("loggedIn"); panel.classList.add("hidden"); loginForm.classList.remove("hidden"); };

// Información
async function loadInfo(){
  const docSnap=await getDoc(doc(db,"Config","info"));
  if(docSnap.exists()){
    const data=docSnap.data();
    infoLanzamientos.value=data.lanzamientos||"";
    infoPlanos.value=data.planos_orbitales||"";
    infoSat.value=data.satelites||"";
  }
}
window.saveAllInfo=async()=>{
  await setDoc(doc(db,"Config","info"),{
    lanzamientos:parseInt(infoLanzamientos.value)||0,
    planos_orbitales:parseInt(infoPlanos.value)||0,
    satelites:parseInt(infoSat.value)||0
  },{merge:true});
  alert("Información actualizada!");
};

// Lanzamientos
let currentEditId = null;
const lTipo = document.getElementById("lTipo");
const lFecha = document.getElementById("lFecha");
const netDiv = document.getElementById("netDiv");
const fechaDiv = document.getElementById("fechaDiv");
const netLevel = document.getElementById("netLevel");
const netYear = document.getElementById("netYear");
const netMonth = document.getElementById("netMonth");
const netDay = document.getElementById("netDay");
const netMonthDiv = document.getElementById("netMonthDiv");
const netDayDiv = document.getElementById("netDayDiv");
const gUrl = document.getElementById("gUrl");

for(let y=new Date().getFullYear();y<=new Date().getFullYear()+10;y++){netYear.innerHTML+=`<option value="${y}">${y}</option>`}

function toggleTipoFecha(){fechaDiv.classList.toggle("hidden",lTipo.value!=="FECHA"); netDiv.classList.toggle("hidden",lTipo.value!=="NET");}
function toggleNetLevel(){const lvl=netLevel.value; netMonthDiv.classList.toggle("hidden",lvl==="year"); netDayDiv.classList.toggle("hidden",lvl!=="day");}
lTipo.addEventListener("change",toggleTipoFecha);
netLevel.addEventListener("change",toggleNetLevel);

window.saveLaunch=async()=>{
  const nombre=document.getElementById("lNombre").value;
  const estado=document.getElementById("lEstado").value;
  const carga=document.getElementById("lCarga").value;
  const galeria = gUrl.value ? [gUrl.value] : [];
  if(!nombre) return alert("Debe poner un nombre de misión");

  let data;
  if(lTipo.value==="FECHA"){data={nombre,estado,tipo:"FECHA",fecha:lFecha.value,carga,galeria}}
  else{
    let netText="NET"; const lvl=netLevel.value;
    if(lvl==="year") netText+=` ${netYear.value}`;
    if(lvl==="month") netText=`NET ${netMonth.value} ${netYear.value}`;
    if(lvl==="day") netText=`NET ${netDay.value} ${netMonth.value} ${netYear.value}`;
    data={nombre,estado,tipo:"NET",net:netText,carga,galeria};
  }

  if(currentEditId){await setDoc(doc(db,"launches",currentEditId),data,{merge:true}); currentEditId=null;}
  else{await addDoc(collection(db,"launches"),data);}
  
  document.getElementById("lNombre").value="";
  document.getElementById("lEstado").value="Planeado";
  lTipo.value="FECHA"; toggleTipoFecha();
  lFecha.value=""; netYear.value=""; netMonth.value=""; netDay.value=""; document.getElementById("lCarga").value="";
  gUrl.value="";

  loadLaunches();
};

window.editLaunch=async(id)=>{
  const dSnap=await getDoc(doc(db,"launches",id));
  if(!dSnap.exists()) return alert("No encontrado");
  const data=dSnap.data();
  document.getElementById("lNombre").value=data.nombre;
  document.getElementById("lEstado").value=data.estado;
  lTipo.value=data.tipo; toggleTipoFecha();
  if(data.tipo==="FECHA") lFecha.value=data.fecha;
  else{
    const parts=data.net.split(" ");
    if(parts.length===2){netLevel.value="year"; netYear.value=parts[1]; toggleNetLevel();}
    if(parts.length===3){netLevel.value="month"; netMonth.value=parts[1]; netYear.value=parts[2]; toggleNetLevel();}
    if(parts.length===4){netLevel.value="day"; netDay.value=parts[1]; netMonth.value=parts[2]; netYear.value=parts[3]; toggleNetLevel();}
  }
  document.getElementById("lCarga").value=data.carga||"";
  gUrl.value=data.galeria?.[0]||"";
  currentEditId=id;
};

window.deleteLaunch=async(id)=>{if(!confirm("¿Seguro?"))return; await deleteDoc(doc(db,"launches",id)); loadLaunches();}

async function loadLaunches(){
  const listDiv=document.getElementById("launchList"); listDiv.innerHTML="";
  const snaps=await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data=d.data(),id=d.id;
    const fecha=data.tipo==="NET"?data.net:new Date(data.fecha).toLocaleString();
    const card=document.createElement("div"); card.className="card";
    card.innerHTML=`
      <div><strong>Nombre:</strong> ${data.nombre}<br>
      <strong>Estado:</strong> ${data.estado}<br>
      <strong>Fecha/NET:</strong> ${fecha}<br>
      <strong>Carga:</strong> ${data.carga}<br>
      <strong>Galería:</strong> ${data.galeria?.join(", ")||"-"}</div>
      <div class="flex" style="margin-top:10px;">
        <button onclick="editLaunch('${id}')">Editar</button>
        <button class="delete" onclick="deleteLaunch('${id}')">Borrar</button>
      </div>
    `;
    listDiv.appendChild(card);
  });
}

// Galería independiente
async function loadGallery(){
  const galleryDiv=document.getElementById("galleryList"); galleryDiv.innerHTML="";
  const snaps=await getDocs(collection(db,"gallery"));
  snaps.forEach(d=>{
    const data=d.data(),id=d.id;
    const card=document.createElement("div"); card.className="card";
    card.innerHTML=`<div>${data.url}</div>
      <div class="flex" style="margin-top:5px;">
        <button class="delete" onclick="deleteGallery('${id}')">Borrar</button>
      </div>`;
    galleryDiv.appendChild(card);
  });
}

window.addGallery=async()=>{
  const url=document.getElementById("imgUrl").value;
  if(!url) return alert("URL vacía");
  await addDoc(collection(db,"gallery"),{url});
  document.getElementById("imgUrl").value="";
  loadGallery();
}
window.deleteGallery=async(id)=>{if(!confirm("¿Seguro?"))return; await deleteDoc(doc(db,"gallery",id)); loadGallery();}

toggleTipoFecha(); toggleNetLevel();
loadLaunches(); loadGallery();

</script>
</body>
</html>