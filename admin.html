<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin | GeoNet</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#0b0f1a;
  color:white;
}
header{
  background:#11172a;
  padding:20px;
  text-align:center;
}
section{
  max-width:850px;
  margin:20px auto;
  background:#1a2140;
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 10px rgba(0,0,0,.4);
}
label{
  display:block;
  margin-top:12px;
}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:none;
  font-size:15px;
}
button{
  background:#4da3ff;
  color:black;
  font-weight:bold;
  cursor:pointer;
}
button:hover{background:#6bb5ff;}
.hidden{display:none;}
ul{padding-left:20px;}
li{margin-bottom:15px;}
.smallBtn{
  width:auto;
  padding:6px 10px;
  margin-left:5px;
}
.version{
  position:fixed;
  right:10px;
  bottom:8px;
  opacity:.6;
  font-size:14px;
}
.card{
  background:#131a33;
  padding:15px;
  border-radius:10px;
}
</style>
</head>

<body>

<header>
<h1>Admin GeoNet</h1>
<p>JS Aerospace</p>
</header>

<section id="login">
<label>Email</label>
<input type="email" id="user">
<label>Contraseña</label>
<input type="password" id="pass">
<button id="loginBtn">Entrar</button>
</section>

<section id="panel" class="hidden">

<h2>Lanzamientos</h2>

<div class="card">
<label>Nombre</label>
<input id="lnName">

<label>Estado</label>
<select id="lnState">
  <option>Planeado</option>
  <option>En progreso</option>
  <option>Exitoso</option>
  <option>Fallido</option>
</select>

<label>Tipo de fecha</label>
<select id="dateType">
  <option value="EXACTA">Fecha exacta</option>
  <option value="NET">NET</option>
</select>

<div id="exactDateBox">
  <label>Fecha y hora (UTC)</label>
  <input type="datetime-local" id="exactDate">
</div>

<div id="netBox" class="hidden">
  <label>Precisión NET</label>
  <select id="netPrecision">
    <option value="none">NET</option>
    <option value="year">NET Año</option>
    <option value="month">NET Mes</option>
    <option value="day">NET Día</option>
  </select>

  <div id="netInputs"></div>
</div>

<label>Links (imágenes o videos)</label>
<input id="lnLinks" placeholder="https://... , https://...">

<button id="addLaunch">Guardar lanzamiento</button>
</div>

<h3>Listado</h3>
<ul id="launchList"></ul>

</section>

<div class="version">V1.2</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, updateDoc } 
from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAIBwQ4YmJNfyPa9js6cox-sOnZMegKaNA",
  authDomain: "geonet-js-aerospace.firebaseapp.com",
  projectId: "geonet-js-aerospace",
  storageBucket: "geonet-js-aerospace.appspot.com",
  messagingSenderId: "651364423254",
  appId: "1:651364423254:web:f4105d4cd47e95512e8df7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// LOGIN
const USER="olanoagus@gmail.com";
const PASS="Simba2011";
loginBtn.onclick=()=>{
  if(user.value===USER && pass.value===PASS){
    login.classList.add("hidden");
    panel.classList.remove("hidden");
  } else alert("Datos incorrectos");
};

// NET / EXACTA
dateType.onchange=()=>{
  exactDateBox.classList.toggle("hidden",dateType.value==="NET");
  netBox.classList.toggle("hidden",dateType.value!=="NET");
};

netPrecision.onchange=()=>{
  netInputs.innerHTML="";
  if(netPrecision.value==="year")
    netInputs.innerHTML=`<input placeholder="Año (2026)">`;
  if(netPrecision.value==="month")
    netInputs.innerHTML=`<input placeholder="Mes (12)"> <input placeholder="Año (2026)">`;
  if(netPrecision.value==="day")
    netInputs.innerHTML=`<input placeholder="Día (25)"> <input placeholder="Mes (12)"> <input placeholder="Año (2026)">`;
};

const launches = collection(db,"launches");

addLaunch.onclick=async()=>{
  let fecha;
  if(dateType.value==="EXACTA"){
    fecha={ tipo:"EXACTA", valor: exactDate.value };
  }else{
    const vals=[...netInputs.querySelectorAll("input")].map(i=>i.value);
    fecha={ tipo:"NET", precision:netPrecision.value, valor:vals.join("-") };
  }

  await addDoc(launches,{
    nombre:lnName.value,
    estado:lnState.value,
    fecha,
    links: lnLinks.value.split(",").map(l=>l.trim()).filter(l=>l)
  });

  lnName.value=""; lnLinks.value=""; exactDate.value="";
};

onSnapshot(launches,snap=>{
  launchList.innerHTML="";
  snap.forEach(d=>{
    const li=document.createElement("li");
    li.innerHTML=`
      <b>${d.data().nombre}</b> (${d.data().estado})
      <br>
      <button class="smallBtn">Eliminar</button>
    `;
    li.querySelector("button").onclick=()=>deleteDoc(d.ref);
    launchList.appendChild(li);
  });
});
</script>

</body>
</html>