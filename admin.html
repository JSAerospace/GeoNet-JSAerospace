<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet Admin V3.3</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#1e90ff;color:#fff;font-weight:bold;cursor:pointer}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
.hidden{display:none}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
.card button{width:48%;margin:2px 1%;background:#28a745;color:#fff;font-weight:bold}
.card button.delete{background:#dc3545}
.flex{display:flex;gap:5px}
.flex select{width:32%}
</style>
</head>
<body>

<section id="login">
<h2>Admin Login</h2>
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</section>

<section id="panel" class="hidden">

<button onclick="logout()" style="margin-bottom:15px;background:#dc3545;">Cerrar sesión</button>

<!-- SECCIÓN DE INFORMACIÓN -->
<h2>Información</h2>
<div class="card">
  <label>Lanzamientos:</label>
  <input id="infoLanzamientos" type="number" placeholder="Cantidad de lanzamientos">
</div>
<div class="card">
  <label>Planos Orbitales:</label>
  <input id="infoPlanos" type="number" placeholder="Cantidad de planos orbitales">
</div>
<div class="card">
  <label>N° de Satélites:</label>
  <input id="infoSat" type="number" placeholder="Cantidad de satélites">
</div>
<button onclick="saveAllInfo()">Cambiar Información</button>

<!-- SECCIÓN DE LANZAMIENTOS -->
<h2>Lanzamiento</h2>
<input id="lNombre" placeholder="Nombre misión">

<select id="lEstado">
<option>PLANNED</option>
<option>NET</option>
<option>LAUNCHED</option>
<option>CANCELLED</option>
</select>

<select id="lTipo" onchange="toggleTipoFecha()">
<option value="FECHA">Fecha Exacta</option>
<option value="NET">NET</option>
</select>

<!-- Fecha exacta -->
<div id="fechaDiv">
<input id="lFecha" type="datetime-local">
</div>

<!-- NET dinámico -->
<div id="netDiv" class="hidden">
<label>Precisión NET:</label>
<select id="netLevel" onchange="toggleNetLevel()">
<option value="year">Solo Año</option>
<option value="month">Mes y Año</option>
<option value="day">Día, Mes y Año</option>
</select>
<div id="netYearDiv" class="flex">
<select id="netYear"></select>
</div>
<div id="netMonthDiv" class="flex hidden">
<select id="netMonth">
<option value="">Mes</option>
<option value="Enero">Enero</option><option value="Febrero">Febrero</option>
<option value="Marzo">Marzo</option><option value="Abril">Abril</option>
<option value="Mayo">Mayo</option><option value="Junio">Junio</option>
<option value="Julio">Julio</option><option value="Agosto">Agosto</option>
<option value="Septiembre">Septiembre</option><option value="Octubre">Octubre</option>
<option value="Noviembre">Noviembre</option><option value="Diciembre">Diciembre</option>
</select>
</div>
<div id="netDayDiv" class="flex hidden">
<select id="netDay">
<option value="">Día</option>
</select>
</div>

<input id="lCarga" placeholder="Carga">
<button onclick="saveLaunch()">Guardar / Actualizar</button>

<h2>Galería</h2>
<input id="gUrl" placeholder="URL imagen o video">
<button onclick="addGallery()">Agregar</button>

<h2>Lanzamientos Existentes</h2>
<div id="launchList"></div>

</section>

<div class="version">v3.3</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,setDoc,collection,addDoc,getDocs,deleteDoc,getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({apiKey:"TU_API_KEY",authDomain:"geonet-js-aerospace.firebaseapp.com",projectId:"geonet-js-aerospace"});
const db = getFirestore(app);

// LOGIN
const loginForm = document.getElementById("login");
const panel = document.getElementById("panel");
const user = document.getElementById("user");
const pass = document.getElementById("pass");

window.addEventListener("load",()=>{
  if(localStorage.getItem("loggedIn")==="true"){
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo();
    loadLaunches();
  }
});

window.login = () => {
  if(user.value==="olanoagus@gmail.com" && pass.value==="Simba2011"){
    localStorage.setItem("loggedIn","true");
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo();
    loadLaunches();
  } else alert("Usuario o contraseña incorrecta");
};

window.logout = () => {
  localStorage.removeItem("loggedIn");
  panel.classList.add("hidden");
  loginForm.classList.remove("hidden");
};

// Información
async function loadInfo(){
  const docRef=doc(db,"Config","info");
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()){
    const data=docSnap.data();
    infoLanzamientos.value = data.lanzamientos || "";
    infoPlanos.value = data.planos_orbitales || "";
    infoSat.value = data.satelites || "";
  }
}
window.saveAllInfo=async()=>{
  await setDoc(doc(db,"Config","info"),{
    lanzamientos: parseInt(infoLanzamientos.value)||0,
    planos_orbitales: parseInt(infoPlanos.value)||0,
    satelites: parseInt(infoSat.value)||0
  },{merge:true});
  alert("Información actualizada!");
};

// Lanzamientos
function toggleTipoFecha(){
  if(lTipo.value==="FECHA"){ 
    document.getElementById("fechaDiv").classList.remove("hidden");
    document.getElementById("netDiv").classList.add("hidden");
  } else {
    document.getElementById("fechaDiv").classList.add("hidden");
    document.getElementById("netDiv").classList.remove("hidden");
    toggleNetLevel();
  }
}

// NET dinámico
const currentYear = new Date().getFullYear();
const netYear = document.getElementById("netYear");
for(let y=currentYear;y<=currentYear+10;y++) netYear.innerHTML += `<option value="${y}">${y}</option>`;

const netDay = document.getElementById("netDay");
for(let d=1;d<=31;d++) netDay.innerHTML += `<option value="${d}">${d}</option>`;

function toggleNetLevel(){
  const level = document.getElementById("netLevel").value;
  document.getElementById("netMonthDiv").classList.toggle("hidden",level==="year");
  document.getElementById("netDayDiv").classList.toggle("hidden",level!=="day");
}

// Guardar lanzamiento
window.saveLaunch = async () => {
  if(!lNombre.value) return alert("Debe poner un nombre de misión");
  let data;
  if(lTipo.value==="FECHA"){
    data = {nombre:lNombre.value,estado:lEstado.value,tipo:"FECHA",fecha:lFecha.value,carga:lCarga.value};
  } else {
    let level = document.getElementById("netLevel").value;
    let netText = "NET";
    if(level==="year") netText += ` ${netYear.value}`;
    if(level==="month") netText = `NET ${netMonth.value} ${netYear.value}`;
    if(level==="day") netText = `NET ${netDay.value} ${netMonth.value} ${netYear.value}`;
    data = {nombre:lNombre.value,estado:lEstado.value,tipo:"NET",net:netText,carga:lCarga.value};
  }
  await addDoc(collection(db,"launches"),data);
  lNombre.value=""; lEstado.value="PLANNED"; lTipo.value="FECHA"; lFecha.value=""; netYear.value=""; netMonth.value=""; netDay.value=""; lCarga.value="";
  toggleTipoFecha();
  loadLaunches();
};

// Galería
window.addGallery = async () => { 
  if(!gUrl.value) return; 
  await addDoc(collection(db,"Gallery"),{url:gUrl.value}); 
  gUrl.value=""; 
};

// Listar lanzamientos
async function loadLaunches(){
  const listDiv = document.getElementById("launchList");
  listDiv.innerHTML="";
  const snaps = await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data=d.data(); const id=d.id;
    let dateDisplay = data.tipo==="NET"?data.net:new Date(data.fecha).toLocaleString();
    listDiv.innerHTML += `<div class="card"><strong>${data.nombre}</strong> - ${data.estado} - ${dateDisplay}<button onclick="editLaunch('${id}')">Editar</button><button class="delete" onclick="deleteLaunch('${id}')">Borrar</button></div>`;
  });
}

// Editar lanzamiento
window.editLaunch = async (id) => {
  const docRef = doc(db,"launches",id);
  const docSnap = await getDocs(collection(db,"launches"));
  docSnap.forEach(d=>{
    if(d.id===id){
      const data=d.data();
      lNombre.value=data.nombre; lEstado.value=data.estado; lTipo.value=data.tipo;
      if(data.tipo==="FECHA"){ lFecha.value=data.fecha; toggleTipoFecha(); }
      else{
        toggleTipoFecha();
        const parts = data.net.split(" ");
        if(parts.length===2){ netYear.value=parts[1]; netLevel.value="year"; toggleNetLevel(); }
        else if(parts.length===3){ netMonth.value=parts[1]; netYear.value=parts[2]; netLevel.value="month"; toggleNetLevel(); }
        else if(parts.length===4){ netDay.value=parts[1]; netMonth.value=parts[2]; netYear.value=parts[3]; netLevel.value="day"; toggleNetLevel(); }
      }
      lCarga.value=data.carga;
    }
  });
  await deleteDoc(docRef);
};

// Borrar lanzamiento
window.deleteLaunch = async (id) => {
  if(!confirm("¿Seguro que quieres borrar este lanzamiento?")) return;
  await deleteDoc(doc(db,"launches",id));
  loadLaunches();
};

loadInfo();
loadLaunches();
toggleTipoFecha();
</script>

</body>
</html>