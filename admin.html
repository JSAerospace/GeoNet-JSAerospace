<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin GeoNet J.S Aerospace</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b0f1a;color:#fff}
header{padding:20px;background:#141a2e;text-align:center;font-size:24px;font-weight:bold;color:#0af}
.container{padding:20px;display:flex;flex-direction:column;gap:20px;max-width:800px;margin:auto}
.card{background:#141a2e;border-radius:12px;padding:15px;box-shadow:0 0 15px rgba(0,0,0,.5)}
.card h2{margin-top:0;color:#0af}
input,select,button{margin:5px 0;padding:8px;border-radius:5px;border:none;width:100%;box-sizing:border-box}
button{background:#0af;color:#000;font-weight:bold;cursor:pointer}
button:hover{opacity:0.8}
.launchItem, .galleryItem{background:#0f1422;padding:10px;margin:5px 0;border-radius:8px}
</style>
</head>
<body>

<header>Admin GeoNet J.S Aerospace</header>

<div class="container" id="loginCard">
<h2>Iniciar Sesión</h2>
<input type="email" id="emailInput" placeholder="Usuario">
<input type="password" id="passInput" placeholder="Contraseña">
<button id="loginBtn">Entrar</button>
<p id="loginError" style="color:red"></p>
</div>

<div class="container" id="adminContent" style="display:none;">

<div class="card" id="infoCard">
<h2>Información</h2>
<label>Lanzamientos:</label>
<input type="number" id="infoLanzamientos">
<label>Planos Orbitales:</label>
<input type="number" id="infoPlanos">
<label>N° de Satélites:</label>
<input type="number" id="infoSat">
<button id="saveInfoBtn">Cambiar Información</button>
</div>

<div class="card" id="launchCard">
<h2>Lanzamientos</h2>
<label>Nombre:</label><input type="text" id="launchName">
<label>Vehículo:</label><input type="text" id="launchVehicle">
<label>Carga:</label><input type="text" id="launchCargo">

<label>Estado de Misión:</label>
<select id="launchStatus">
<option>Éxito</option>
<option>Fallido</option>
<option>Planeado</option>
<option>En Vuelo</option>
</select>

<label>Tipo de Fecha:</label>
<select id="launchDateType">
<option value="FECHA">Fecha Exacta</option>
<option value="NET">NET</option>
</select>

<div id="netOptions" style="display:none">
<label>Tipo NET:</label>
<select id="netType">
<option value="AÑO">NET Año</option>
<option value="MES_AÑO">NET Mes y Año</option>
<option value="DIA_MES_AÑO">NET Día, Mes y Año</option>
</select>
<div id="netInputs"></div>
</div>

<div id="fechaExactaInputs">
<label>Fecha Exacta:</label>
<input type="datetime-local" id="launchDate">
</div>

<label>Galería (subir imagen/video):</label>
<input type="file" id="fileInput">
<button id="uploadBtn">Subir a Galería</button>

<button id="addLaunchBtn">Agregar/Editar Lanzamiento</button>

<h3>Lanzamientos Existentes</h3>
<div id="existingLaunches">Cargando...</div>
</div>

<div class="card" id="galleryCard">
<h2>Galería</h2>
<div id="galleryContent">Cargando...</div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, collection, addDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

const firebaseConfig = {
apiKey:"TU_API_KEY",
authDomain:"geonet-js-aerospace.firebaseapp.com",
projectId:"geonet-js-aerospace",
storageBucket:"geonet-js-aerospace.appspot.com"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// LOGIN
const loginCard = document.getElementById("loginCard");
const adminContent = document.getElementById("adminContent");
const loginBtn = document.getElementById("loginBtn");
const emailInput = document.getElementById("emailInput");
const passInput = document.getElementById("passInput");
const loginError = document.getElementById("loginError");

const USER_EMAIL = "olanoagus@gmail.com";
const USER_PASS = "Simba2011";

loginBtn.addEventListener("click", ()=>{
if(emailInput.value===USER_EMAIL && passInput.value===USER_PASS){
  localStorage.setItem("loggedIn","true");
  loginCard.style.display="none";
  adminContent.style.display="flex";
  loadAdminData();
}else{
  loginError.textContent="Usuario o contraseña incorrectos";
});

if(localStorage.getItem("loggedIn")==="true"){
  loginCard.style.display="none";
  adminContent.style.display="flex";
  loadAdminData();
}

// INFORMACIÓN
const infoLanzamientos = document.getElementById("infoLanzamientos");
const infoPlanos = document.getElementById("infoPlanos");
const infoSat = document.getElementById("infoSat");
document.getElementById("saveInfoBtn").addEventListener("click", async ()=>{
await setDoc(doc(db,"Config","info"),{
  lanzamientos: infoLanzamientos.value,
  planos_orbitales: infoPlanos.value,
  satelites: infoSat.value
});
alert("Información actualizada!");
});

// LANZAMIENTOS
const launchName = document.getElementById("launchName");
const launchVehicle = document.getElementById("launchVehicle");
const launchCargo = document.getElementById("launchCargo");
const launchStatus = document.getElementById("launchStatus");
const launchDateType = document.getElementById("launchDateType");
const netOptions = document.getElementById("netOptions");
const netType = document.getElementById("netType");
const netInputs = document.getElementById("netInputs");
const fechaExactaInputs = document.getElementById("fechaExactaInputs");
const launchDate = document.getElementById("launchDate");
const addLaunchBtn = document.getElementById("addLaunchBtn");
let editingId = null;

launchDateType.addEventListener("change", ()=>{
  if(launchDateType.value==="NET"){
    netOptions.style.display="block";
    fechaExactaInputs.style.display="none";
  }else{
    netOptions.style.display="none";
    fechaExactaInputs.style.display="block";
  }
});

// NET Inputs dinámicos
netType.addEventListener("change", ()=>{
  let html="";
  if(netType.value==="AÑO") html=`<input type="number" id="netYear" placeholder="Año">`;
  if(netType.value==="MES_AÑO") html=`<input type="number" id="netMonth" placeholder="Mes (1-12)"><input type="number" id="netYear" placeholder="Año">`;
  if(netType.value==="DIA_MES_AÑO") html=`<input type="number" id="netDay" placeholder="Día"><input type="number" id="netMonth" placeholder="Mes"><input type="number" id="netYear" placeholder="Año">`;
  netInputs.innerHTML=html;
});

addLaunchBtn.addEventListener("click", async ()=>{
  let fechaData=null;
  let tipo="FECHA";
  let netStr=null;
  if(launchDateType.value==="FECHA"){ fechaData=launchDate.value; tipo="FECHA"; }
  else{
    tipo="NET";
    if(netType.value==="AÑO") netStr=`NET ${document.getElementById("netYear").value}`;
    if(netType.value==="MES_AÑO") netStr=`NET ${document.getElementById("netMonth").value}/${document.getElementById("netYear").value}`;
    if(netType.value==="DIA_MES_AÑO") netStr=`NET ${document.getElementById("netDay").value}/${document.getElementById("netMonth").value}/${document.getElementById("netYear").value}`;
  }
  const data = {
    nombre: launchName.value,
    vehiculo: launchVehicle.value,
    carga: launchCargo.value,
    estado: launchStatus.value,
    tipo,
    fecha: fechaData,
    net: netStr
  };
  if(editingId){ await setDoc(doc(db,"launches",editingId),data); editingId=null; }
  else{ await addDoc(collection(db,"launches"),data); }
  alert("Lanzamiento guardado!");
  loadLaunches();
});

// GALERÍA
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const galleryContent = document.getElementById("galleryContent");

uploadBtn.addEventListener("click", async ()=>{
  const file = fileInput.files[0];
  if(!file){ alert("Selecciona un archivo"); return; }
  const storageRef = ref(storage,`gallery/${file.name}`);
  await uploadBytes(storageRef,file);
  const url = await getDownloadURL(storageRef);
  await addDoc(collection(db,"gallery"),{url});
  alert("Archivo subido!");
  loadGallery();
});

// CARGAR EXISTENTE
async function loadAdminData(){
  // Información
  const docSnap = await getDoc(doc(db,"Config","info"));
  if(docSnap.exists()){
    const data = docSnap.data();
    infoLanzamientos.value = data.lanzamientos ?? "";
    infoPlanos.value = data.planos_orbitales ?? "";
    infoSat.value = data.satelites ?? "";
  }
  loadLaunches();
  loadGallery();
}

// Lanzamientos existentes
async function loadLaunches(){
  const container = document.getElementById("existingLaunches");
  container.innerHTML="";
  const snaps = await getDocs(collection(db,"launches"));
  if(snaps.empty){ container.textContent="No hay lanzamientos."; return; }
  snaps.forEach(d=>{
    const data=d.data();
    const div=document.createElement("div");
    div.className="launchItem";
    div.innerHTML=`<strong>${data.nombre}</strong> - ${data.estado} - ${data.tipo==="FECHA"?data.fecha:data.net}
                   <button onclick="editLaunch('${d.id}')">Editar</button>
                   <button onclick="deleteLaunch('${d.id}')">Eliminar</button>`;
    container.appendChild(div);
  });
}

// Funciones globales
window.editLaunch = async (id)=>{
  const docSnap = await getDoc(doc(db,"launches",id));
  if(docSnap.exists()){
    const data = docSnap.data();
    launchName.value=data.nombre;
    launchVehicle.value=data.vehiculo;
    launchCargo.value=data.carga;
    launchStatus.value=data.estado;
    launchDateType.value=data.tipo;
    launchDate.value=data.fecha||"";
    if(data.tipo==="NET"){ netOptions.style.display="block"; fechaExactaInputs.style.display="none"; netType.value="AÑO"; netInputs.innerHTML=`<input type="number" id="netYear" value="${data.net.split(" ")[1]}">`; }
    editingId=id;
  }
};
window.deleteLaunch = async (id)=>{
  if(confirm("Eliminar lanzamiento?")){
    await deleteDoc(doc(db,"launches",id));
    loadLaunches();
  }
};

// Galería
async function loadGallery(){
  galleryContent.innerHTML="";
  const snaps = await getDocs(collection(db,"gallery"));
  if(snaps.empty){ galleryContent.textContent="No hay elementos."; return; }
  snaps.forEach(d=>{
    const data=d.data();
    const div=document.createElement("div");
    div.className="galleryItem";
    if(data.url.match(/\.(jpg|jpeg|png|gif)$/i)) div.innerHTML=`<img src="${data.url}"><button onclick="deleteGallery('${d.id}')">Eliminar</button>`;
    else if(data.url.match(/\.(mp4|webm|ogg)$/i)) div.innerHTML=`<video controls src="${data.url}"></video><button onclick="deleteGallery('${d.id}')">Eliminar</button>`;
    else div.innerHTML=`<a href="${data.url}" target="_blank">${data.url}</a><button onclick="deleteGallery('${d.id}')">Eliminar</button>`;
    galleryContent.appendChild(div);
  });
}
window.deleteGallery = async (id)=>{
  if(confirm("Eliminar elemento de galería?")){
    await deleteDoc(doc(db,"gallery",id));
    loadGallery();
  }
};
</script>
</body>
</html>