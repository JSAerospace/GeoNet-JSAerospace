<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>GeoNet Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#0b0f1a;color:#fff}
section{padding:20px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:none}
button{background:#1e90ff;color:#fff;font-weight:bold;cursor:pointer}
.card{background:#141a2e;border-radius:12px;padding:15px;margin-bottom:15px;box-shadow:0 0 10px rgba(0,0,0,.4)}
.hidden{display:none}
.version{position:fixed;bottom:10px;right:10px;font-size:12px;opacity:.6}
.card button{width:48%;margin:2px 1%;background:#28a745;color:#fff;font-weight:bold}
.card button.delete{background:#dc3545}
</style>
</head>
<body>

<section id="login">
<h2>Admin Login</h2>
<input id="user" placeholder="Usuario">
<input id="pass" type="password" placeholder="Contraseña">
<button onclick="login()">Entrar</button>
</section>

<section id="panel" class="hidden">

<!-- SECCIÓN DE INFORMACIÓN MEJORADA -->
<h2>Información</h2>
<div id="infoList"></div>
<input id="infoNombre" placeholder="Nombre">
<input id="infoValor" placeholder="Valor">
<button onclick="saveInfo()">Guardar</button>

<!-- SECCIÓN DE LANZAMIENTOS -->
<h2>Lanzamiento</h2>
<input id="lNombre" placeholder="Nombre misión">
<select id="lEstado">
<option>PLANNED</option>
<option>NET</option>
<option>LAUNCHED</option>
<option>CANCELLED</option>
</select>
<select id="lTipo">
<option value="FECHA">Fecha exacta</option>
<option value="NET">NET</option>
</select>
<input id="lFecha" type="datetime-local">
<input id="lNet" placeholder="NET Diciembre 2026">
<input id="lCarga" placeholder="Carga">
<button onclick="saveLaunch()">Guardar / Actualizar</button>

<h2>Galería</h2>
<input id="gUrl" placeholder="URL imagen o video">
<button onclick="addGallery()">Agregar</button>

<h2>Lanzamientos Existentes</h2>
<div id="launchList"></div>

</section>

<div class="version">v1.5</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {getFirestore,doc,setDoc,collection,addDoc,getDocs,updateDoc,deleteDoc,getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey: "TU_API_KEY",
  authDomain: "geonet-js-aerospace.firebaseapp.com",
  projectId: "geonet-js-aerospace"
});
const db = getFirestore(app);

const loginForm = document.getElementById("login");
const panel = document.getElementById("panel");
const user = document.getElementById("user");
const pass = document.getElementById("pass");

// Login simple
window.login = () => {
  if(user.value==="olanoagus@gmail.com" && pass.value==="Simba2011"){
    loginForm.classList.add("hidden");
    panel.classList.remove("hidden");
    loadInfo();
    loadLaunches();
  } else {
    alert("Usuario o contraseña incorrecta");
  }
};

// ---------- SECCIÓN DE INFORMACIÓN ----------
async function loadInfo(){
  const infoList=document.getElementById("infoList");
  infoList.innerHTML="";
  const docRef=doc(db,"Config","info");
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()){
    const data=docSnap.data();
    
    // Mostrar lanzamientos y planos orbitales primero
    const keysOrder=["lanzamientos","planos_orbitales"];
    keysOrder.forEach(k=>{
      if(data[k]!==undefined){
        infoList.innerHTML += `
        <div class="card">
          <strong>${k}</strong>: ${data[k]}
          <button onclick="editInfo('${k}','${data[k]}')">Editar</button>
        </div>`;
      }
    });

    // Mostrar los demás campos
    for(const key in data){
      if(!keysOrder.includes(key)){
        infoList.innerHTML += `
        <div class="card">
          <strong>${key}</strong>: ${data[key]}
          <button onclick="editInfo('${key}','${data[key]}')">Editar</button>
        </div>`;
      }
    }
  }
}

// Guardar o actualizar Información
window.saveInfo=async()=>{
  if(!infoNombre.value || !infoValor.value) return alert("Completa ambos campos");
  await setDoc(doc(db,"Config","info"),{
    [infoNombre.value]:infoValor.value
  },{merge:true});
  infoNombre.value="";
  infoValor.value="";
  loadInfo();
};

// Editar información existente
window.editInfo=(key,value)=>{
  infoNombre.value=key;
  infoValor.value=value;
};

// ---------- SECCIÓN DE LANZAMIENTOS ----------
window.saveLaunch = async () => {
  if(!lNombre.value) return alert("Debe poner un nombre de misión");
  let data;
  if(lTipo.value==="NET"){
    data={
      nombre:lNombre.value,
      estado:lEstado.value,
      tipo:"NET",
      net:lNet.value,
      carga:lCarga.value
    };
  } else {
    data={
      nombre:lNombre.value,
      estado:lEstado.value,
      tipo:"FECHA",
      fecha:lFecha.value,
      carga:lCarga.value
    };
  }
  await addDoc(collection(db,"launches"), data);
  lNombre.value="";
  lEstado.value="PLANNED";
  lTipo.value="FECHA";
  lFecha.value="";
  lNet.value="";
  lCarga.value="";
  loadLaunches();
};

// ---------- GALERÍA ----------
window.addGallery = async () => {
  if(!gUrl.value) return alert("Ingrese URL");
  await addDoc(collection(db,"Gallery"),{url:gUrl.value});
  gUrl.value="";
};

// ---------- LISTAR LANZAMIENTOS EXISTENTES ----------
async function loadLaunches(){
  const listDiv = document.getElementById("launchList");
  listDiv.innerHTML="";
  const snaps = await getDocs(collection(db,"launches"));
  snaps.forEach(d=>{
    const data=d.data();
    const id=d.id;
    let dateDisplay = data.tipo==="NET"?data.net:new Date(data.fecha).toLocaleString();
    listDiv.innerHTML += `
    <div class="card">
      <strong>${data.nombre}</strong> - ${data.estado} - ${dateDisplay}
      <button onclick="editLaunch('${id}')">Editar</button>
      <button class="delete" onclick="deleteLaunch('${id}')">Borrar</button>
    </div>`;
  });
}

// Editar lanzamiento
window.editLaunch = async (id) => {
  const docRef = doc(db,"launches",id);
  const docSnap = await getDocs(collection(db,"launches"));
  docSnap.forEach(d=>{
    if(d.id===id){
      const data=d.data();
      lNombre.value=data.nombre;
      lEstado.value=data.estado;
      lTipo.value=data.tipo;
      lFecha.value=data.fecha || "";
      lNet.value=data.net || "";
      lCarga.value=data.carga;
    }
  });
  await deleteDoc(docRef);
};

// Borrar lanzamiento
window.deleteLaunch = async (id) => {
  if(!confirm("¿Seguro que quieres borrar este lanzamiento?")) return;
  await deleteDoc(doc(db,"launches",id));
  loadLaunches();
};
</script>

</body>
</html>